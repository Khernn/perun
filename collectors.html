
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Collectors Overview &#8212; Perun 0.14.1 documentation</title>
    <link rel="stylesheet" href="_static/perun.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.14.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Postprocessors Overview" href="postprocessors.html" />
    <link rel="prev" title="Command Line Interface" href="cli.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-perun.collect">
<span id="id1"></span><span id="collectors-overview"></span><h1>Collectors Overview<a class="headerlink" href="#module-perun.collect" title="Permalink to this headline">¶</a></h1>
<p>Performance profiles originate either from the user’s own means (i.e. by
building their own collectors and generating the profiles w.r.t
<a class="reference internal" href="profile.html#profile-spec"><span class="std std-ref">Specification of Profile Format</span></a>) or using one of the collectors from Perun’s tool suite.</p>
<p>Perun can collect profiling data in two ways:</p>
<blockquote>
<div><ol class="arabic simple">
<li>By <strong>Directly running collectors</strong> through <code class="docutils literal"><span class="pre">perun</span> <span class="pre">collect</span></code> command,
that generates profile using a single collector with given collector
configuration. The resulting profiles are not postprocessed in any way.</li>
<li>By <strong>Using job specification</strong> either as a single run of batch of
profiling jobs using <code class="docutils literal"><span class="pre">perun</span> <span class="pre">run</span> <span class="pre">job</span></code> or according to the specification
of the so called job matrix using <code class="docutils literal"><span class="pre">perun</span> <span class="pre">run</span> <span class="pre">matrix</span></code> command.</li>
</ol>
</div></blockquote>
<p>The format of resulting profiles is w.r.t. <a class="reference internal" href="profile.html#profile-spec"><span class="std std-ref">Specification of Profile Format</span></a>. The
<a class="reference internal" href="profile.html#perfreg-origin"><code class="xref std std-preg docutils literal"><span class="pre">origin</span></code></a> is set to the current <code class="docutils literal"><span class="pre">HEAD</span></code> of the wrapped repository.
However, note that uncommited changes may skew the resulting profile and Perun
cannot guard your project against this. Further, <a class="reference internal" href="profile.html#perfreg-collector_info"><code class="xref std std-preg docutils literal"><span class="pre">collector_info</span></code></a> is
filled with configuration of the run collector.</p>
<p>All of the automatically generated profiles are stored in the <code class="docutils literal"><span class="pre">.perun/jobs/</span></code>
directory as a file with the <code class="docutils literal"><span class="pre">.perf</span></code> extension. The filename is by default
automatically generated according to the following template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">-</span><span class="n">collector</span><span class="o">-</span><span class="n">workload</span><span class="o">-</span><span class="n">timestamp</span><span class="o">.</span><span class="n">perf</span>
</pre></div>
</div>
<p>Profiles can be further registered and stored in persistent storage using
<code class="docutils literal"><span class="pre">perun</span> <span class="pre">add</span></code> command.  Then both stored and pending profiles (i.e. those not
yet assigned) can be postprocessed using the <code class="docutils literal"><span class="pre">perun</span> <span class="pre">postprocessby</span></code> or
interpreted using available interpretation techniques using <code class="docutils literal"><span class="pre">perun</span> <span class="pre">show</span></code>.
Refer to <a class="reference internal" href="cli.html"><span class="doc">Command Line Interface</span></a>, <a class="reference internal" href="postprocessors.html"><span class="doc">Postprocessors Overview</span></a> and <a class="reference internal" href="views.html"><span class="doc">Visualizations Overview</span></a> for more details
about running command line commands, capabilities of postprocessors and
interpretation techniques respectively. Internals of perun storage is described
in <a class="reference internal" href="internals.html"><span class="doc">Perun Internals</span></a>.</p>
<a class="reference internal image-reference" href="_images/architecture-collectors.svg"><div align="center" class="align-center"><img alt="_images/architecture-collectors.svg" src="_images/architecture-collectors.svg" width="100%" /></div>
</a>
<div class="section" id="supported-collectors">
<span id="collectors-list"></span><h2>Supported Collectors<a class="headerlink" href="#supported-collectors" title="Permalink to this headline">¶</a></h2>
<p>Perun’s tool suite currently contains the following three collectors:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#collectors-complexity"><span class="std std-ref">Complexity Collector</span></a> (authored by <strong>Jirka Pavela</strong>), collects running times of C/C++
functions along with the size of the structures they were executed on. E.g. this collects
resources such that function <code class="docutils literal"><span class="pre">search</span></code> over the class <code class="docutils literal"><span class="pre">SingleLinkedList</span></code> took 100ms on
single linked list with one million elements. <a class="reference internal" href="#collectors-complexity-examples"><span class="std std-ref">Examples</span></a> shows
concrete examples of profiles generated by <a class="reference internal" href="#collectors-complexity"><span class="std std-ref">Complexity Collector</span></a></li>
<li><a class="reference internal" href="#collectors-memory"><span class="std std-ref">Memory Collector</span></a> (authored by <strong>Radima Podola</strong>), collects specifications of
allocations in C/C++ programs, such as the type of allocation or the full call trace.
<a class="reference internal" href="#collectors-memory-examples"><span class="std std-ref">Examples</span></a> shows concrete generated profiles by
<a class="reference internal" href="#collectors-memory"><span class="std std-ref">Memory Collector</span></a>.</li>
<li><a class="reference internal" href="#collectors-time"><span class="std std-ref">Time Collector</span></a>, collects overall running times of arbitrary commands. Internally
implemented as a simple wrapper over <code class="docutils literal"><span class="pre">time</span></code> utility</li>
</ol>
</div></blockquote>
<p>All of the listed collectors can be run from command line. For more information about command line
interface for individual collectors refer to <a class="reference internal" href="cli.html#cli-collect-units-ref"><span class="std std-ref">Collect units</span></a>.</p>
<p>Collector modules are implementation independent (hence, can be written in any language) and only
requires simple python interface registered within Perun. For brief tutorial how to create and
register new collectors in Perun refer to <a class="reference internal" href="#collectors-custom"><span class="std std-ref">Creating your own Collector</span></a>.</p>
<div class="section" id="module-perun.collect.complexity">
<span id="complexity-collector"></span><span id="collectors-complexity"></span><h3>Complexity Collector<a class="headerlink" href="#module-perun.collect.complexity" title="Permalink to this headline">¶</a></h3>
<p>Complexity collector collects running times of C/C++ functions along with
the sizes of the structures they were executed on. The collected data are
suitable for further postprocessing using the regression analysis and
visualization by scatter plots.</p>
<div class="section" id="overview-and-command-line-interface">
<span id="collectors-complexity-cli"></span><h4>Overview and Command Line Interface<a class="headerlink" href="#overview-and-command-line-interface" title="Permalink to this headline">¶</a></h4>
<div class="section" id="perun-collect-complexity">
<h5>perun collect complexity<a class="headerlink" href="#perun-collect-complexity" title="Permalink to this headline">¶</a></h5>
<p>Generates <cite>complexity</cite> performance profile, capturing running times of
function depending on underlying structural sizes.</p>
<dl class="docutils">
<dt></dt>
<dd><ul class="first last simple">
<li><strong>Limitations</strong>: C/C++ binaries</li>
<li><strong>Metric</strong>: <cite>mixed</cite> (captures both <cite>time</cite> and <cite>size</cite> consumption)</li>
<li><strong>Dependencies</strong>: <code class="docutils literal"><span class="pre">SystemTap</span></code> (+ corresponding requirements e.g. kernel -dbgsym version)</li>
<li><strong>Default units</strong>: <cite>us</cite> for <cite>time</cite>, <cite>element number</cite> for <cite>size</cite></li>
</ul>
</dd>
</dl>
<p>Example of collected resources is as follows:</p>
<pre class="literal-block">
{
    &quot;amount&quot;: 11,
    &quot;subtype&quot;: &quot;time delta&quot;,
    &quot;type&quot;: &quot;mixed&quot;,
    &quot;uid&quot;: &quot;SLList_init(SLList*)&quot;,
    &quot;structure-unit-size&quot;: 0
}
</pre>
<p>Complexity collector provides various collection <em>strategies</em> which are supposed to provide
sensible default settings for collection. This allows the user to choose suitable
collection method without the need of detailed rules / sampling specification. Currently
supported strategies are:</p>
<dl class="docutils">
<dt></dt>
<dd><ul class="first simple">
<li><strong>userspace</strong>: This strategy traces all userspace functions / code blocks without</li>
</ul>
<p class="last">the use of sampling. Note that this strategy might be resource-intensive.
* <strong>all</strong>: This strategy traces all userspace + library + kernel functions / code blocks
that are present in the traced binary without the use of sampling. Note that this strategy
might be very resource-intensive.
* <strong>u_sampled</strong>: Sampled version of the <strong>userspace</strong> strategy. This method uses sampling
to reduce the overhead and resources consumption.
* <strong>a_sampled</strong>: Sampled version of the <strong>all</strong> strategy. Its goal is to reduce the
overhead and resources consumption of the <strong>all</strong> method.
* <strong>custom</strong>: User-specified strategy. Requires the user to specify rules and sampling
manually.</p>
</dd>
</dl>
<p>Note that manually specified parameters have higher priority than strategy specification
and it is thus possible to override concrete rules / sampling by the user.</p>
<p>Complexity profiles are suitable for postprocessing by
<a class="reference internal" href="postprocessors.html#postprocessors-regression-analysis"><span class="std std-ref">Regression Analysis</span></a> since they capture dependency of
time consumption depending on the size of the structure. This allows one to
model the estimation of complexity of individual functions.</p>
<p>Scatter plots are suitable visualization for profiles collected by
<cite>complexity</cite> collector, which plots individual points along with regression
models (if the profile was postprocessed by regression analysis). Run
<code class="docutils literal"><span class="pre">perun</span> <span class="pre">show</span> <span class="pre">scatter</span> <span class="pre">--help</span></code> or refer to <a class="reference internal" href="views.html#views-scatter"><span class="std std-ref">Scatter Plot</span></a> for more
information about <cite>scatter plots</cite>.</p>
<p>Refer to <a class="reference internal" href="#collectors-complexity"><span class="std std-ref">Complexity Collector</span></a> for more thorough description and
examples of <cite>complexity</cite> collector.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>perun collect complexity <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="option">
<dt id="cmdoption-perun-collect-complexity-m">
<code class="descname">-m</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--method</code><code class="descclassname"> &lt;method&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-complexity-m" title="Permalink to this definition">¶</a></dt>
<dd><p>Select strategy for probing the binary. See documentation for detailed explanation for each strategy.  [required]</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-complexity-r">
<code class="descname">-r</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--rules</code><code class="descclassname"> &lt;rules&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-complexity-r" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the probe points for profiling.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-complexity-s">
<code class="descname">-s</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--sampling</code><code class="descclassname"> &lt;sampling&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-complexity-s" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the runtime sampling of the given probe points.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-complexity-g">
<code class="descname">-g</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--global_sampling</code><code class="descclassname"> &lt;global_sampling&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-complexity-g" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the global sample for all probes, –sampling parameter for specific rules have higher priority.</p>
</dd></dl>

</div>
</div>
<div class="section" id="examples">
<span id="collectors-complexity-examples"></span><h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="hll">  <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;f7f3dcea69b97f2b03c421a223a770917149cfae&quot;</span><span class="p">,</span>
</span>  <span class="nt">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;../stap-collector/tst&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
    <span class="nt">&quot;units&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">      <span class="nt">&quot;mixed(time delta)&quot;</span><span class="p">:</span> <span class="s2">&quot;us&quot;</span>
</span>    <span class="p">},</span>
    <span class="nt">&quot;workload&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="p">},</span>
<span class="hll">  <span class="nt">&quot;collector_info&quot;</span><span class="p">:</span> <span class="p">{</span>
</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;complexity&quot;</span><span class="p">,</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;SLList_init&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SLList_insert&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SLList_search&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SLList_destroy&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;sampling&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;func&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_insert&quot;</span><span class="p">,</span>
          <span class="nt">&quot;sample&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;func&quot;</span><span class="p">:</span> <span class="s2">&quot;func1&quot;</span><span class="p">,</span>
          <span class="nt">&quot;sample&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span>
      <span class="nt">&quot;global_sampling&quot;</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;postprocessors&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;global&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;6.8e-05s&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
<span class="hll">        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_init(SLList*)&quot;</span><span class="p">,</span>
</span>        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="p">{</span>
<span class="hll">        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_search(SLList*, int)&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span>      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_insert(SLList*, int)&quot;</span><span class="p">,</span>
        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_insert(SLList*, int)&quot;</span><span class="p">,</span>
        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_insert(SLList*, int)&quot;</span><span class="p">,</span>
        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_insert(SLList*, int)&quot;</span><span class="p">,</span>
        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">3</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;time delta&quot;</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;SLList_destroy(SLList*)&quot;</span><span class="p">,</span>
        <span class="nt">&quot;structure-unit-size&quot;</span><span class="p">:</span> <span class="mi">4</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above is an example of profiled data for the simple manipulation with program with single
linked list. Profile captured running times of three functions—<code class="docutils literal"><span class="pre">SLList_init</span></code> (an
initialization of single linked list), <code class="docutils literal"><span class="pre">SLList_destroy</span></code> (a destruction of single linked list) and
<code class="docutils literal"><span class="pre">SLList_search</span></code> (search over the single linked list).</p>
<p>Highlighted lines show important keys and regions in the profile, e.g. the <a class="reference internal" href="profile.html#perfreg-origin"><code class="xref std std-preg docutils literal"><span class="pre">origin</span></code></a>,
<code class="xref std std-preg docutils literal"><span class="pre">collector-info</span></code> or <a class="reference internal" href="profile.html#perfkey-resources"><em class="xref std std-pkey">resources</em></a>.</p>
<img alt="_images/complexity-scatter-with-models.png" src="_images/complexity-scatter-with-models.png" />
<p>The <a class="reference internal" href="views.html#views-scatter"><span class="std std-ref">Scatter Plot</span></a> above shows the example of visualization of complexity profile. Each
points corresponds to the running time of the <code class="docutils literal"><span class="pre">SLList_search</span></code> function over the single linked
list with <code class="docutils literal"><span class="pre">structure-unit-size</span></code> elements. Elements are further interleaved with set of models
obtained by <a class="reference internal" href="postprocessors.html#postprocessors-regression-analysis"><span class="std std-ref">Regression Analysis</span></a>. The light green line corresponds to <cite>linear</cite>
model, which seems to be the most fitting to model the performance of given function.</p>
<img alt="_images/complexity-bars.png" src="_images/complexity-bars.png" />
<p>The <a class="reference internal" href="views.html#views-bars"><span class="std std-ref">Bars Plot</span></a> above shows the overall sum of the running times for each
<code class="docutils literal"><span class="pre">structure-unit-size</span></code> for the <code class="docutils literal"><span class="pre">SLList_search</span></code> function. The interpretation highlights that the
most of the consumed running time were over the single linked lists with 41 elements.</p>
<img alt="_images/complexity-flow.png" src="_images/complexity-flow.png" />
<p>The <a class="reference internal" href="views.html#views-flow"><span class="std std-ref">Flow Plot</span></a> above shows the trend of the average running time of the <code class="docutils literal"><span class="pre">SLList_search</span></code>
function depending on the size of the structure we execute the search on.</p>
</div>
</div>
<div class="section" id="module-perun.collect.memory">
<span id="memory-collector"></span><span id="collectors-memory"></span><h3>Memory Collector<a class="headerlink" href="#module-perun.collect.memory" title="Permalink to this headline">¶</a></h3>
<p>Memory collector collects allocations of C/C++ functions, target addresses
of allocations, type of allocations, etc. The collected data are suitable for
visualiation using e.g. <a class="reference internal" href="views.html#views-heapmap"><span class="std std-ref">Heap Map</span></a>.</p>
<div class="section" id="id2">
<h4>Overview and Command Line Interface<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="section" id="perun-collect-memory">
<h5>perun collect memory<a class="headerlink" href="#perun-collect-memory" title="Permalink to this headline">¶</a></h5>
<p>Generates <cite>memory</cite> performance profiel, capturing memory allocations of
different types along with target address and full call trace.</p>
<dl class="docutils">
<dt></dt>
<dd><ul class="first last simple">
<li><strong>Limitations</strong>: C/C++ binaries</li>
<li><strong>Metric</strong>: <cite>memory</cite></li>
<li><strong>Dependencies</strong>: <code class="docutils literal"><span class="pre">libunwind.so</span></code> and custom <code class="docutils literal"><span class="pre">libmalloc.so</span></code></li>
<li><strong>Default units</strong>: <cite>B</cite> for <cite>memory</cite></li>
</ul>
</dd>
</dl>
<p>The following snippet shows the example of resources collected by <cite>memory</cite>
profiler. It captures allocations done by functions with more detailed
description, such as the type of allocation, trace, etc.</p>
<pre class="literal-block">
{
    &quot;type&quot;: &quot;memory&quot;,
    &quot;subtype&quot;: &quot;malloc&quot;,
    &quot;address&quot;: 19284560,
    &quot;amount&quot;: 4,
    &quot;trace&quot;: [
        {
            &quot;source&quot;: &quot;../memory_collect_test.c&quot;,
            &quot;function&quot;: &quot;main&quot;,
            &quot;line&quot;: 22
        },
    ],
    &quot;uid&quot;: {
        &quot;source&quot;: &quot;../memory_collect_test.c&quot;,
        &quot;function&quot;: &quot;main&quot;,
        &quot;line&quot;: 22
    }
},
</pre>
<p><cite>Memory</cite> profiles can be efficiently interpreted using <a class="reference internal" href="views.html#views-heapmap"><span class="std std-ref">Heap Map</span></a>
technique (together with its <cite>heat</cite> mode), which shows memory allocations
(by functions) in memory address map.</p>
<p>Refer to <a class="reference internal" href="#collectors-memory"><span class="std std-ref">Memory Collector</span></a> for more thorough description and
examples of <cite>memory</cite> collector.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>perun collect memory <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="option">
<dt id="cmdoption-perun-collect-memory-s">
<code class="descname">-s</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--sampling</code><code class="descclassname"> &lt;sampling&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-memory-s" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the sampling interval for profiling the allocations. I.e. memory snapshots will be collected each &lt;sampling&gt; seconds.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-memory-no-source">
<code class="descname">--no-source</code><code class="descclassname"> &lt;no_source&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-memory-no-source" title="Permalink to this definition">¶</a></dt>
<dd><p>Will exclude allocations done from &lt;no_source&gt; file during the profiling.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-memory-no-func">
<code class="descname">--no-func</code><code class="descclassname"> &lt;no_func&gt;</code><a class="headerlink" href="#cmdoption-perun-collect-memory-no-func" title="Permalink to this definition">¶</a></dt>
<dd><p>Will exclude allocations done by &lt;no func&gt; function during the profiling.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-perun-collect-memory-a">
<code class="descname">-a</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--all</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-perun-collect-memory-a" title="Permalink to this definition">¶</a></dt>
<dd><p>Will record the full trace for each allocation, i.e. it will include all allocators and even unreachable records.</p>
</dd></dl>

</div>
</div>
<div class="section" id="collectors-memory-examples">
<span id="id3"></span><h4>Examples<a class="headerlink" href="#collectors-memory-examples" title="Permalink to this headline">¶</a></h4>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="hll">  <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;74288675e4074f1ad5bbb0d3b3253911ab42267a&quot;</span><span class="p">,</span>
</span>  <span class="nt">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;workload&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;./mct&quot;</span><span class="p">,</span>
<span class="hll">    <span class="nt">&quot;units&quot;</span><span class="p">:</span> <span class="p">{</span>
</span>      <span class="nt">&quot;memory&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="p">},</span>
<span class="hll">  <span class="nt">&quot;collector_info&quot;</span><span class="p">:</span> <span class="p">{</span>
</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;no_func&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;no_source&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;all&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&quot;sampling&quot;</span><span class="p">:</span> <span class="mf">0.025</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;postprocessors&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="hll">  <span class="nt">&quot;snapshots&quot;</span><span class="p">:</span> <span class="p">[</span>
</span>    <span class="p">{</span>
      <span class="nt">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
<span class="hll">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span>
</span><span class="hll">          <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;malloc&quot;</span><span class="p">,</span>
</span><span class="hll">          <span class="nt">&quot;address&quot;</span><span class="p">:</span> <span class="mi">19284560</span><span class="p">,</span>
</span><span class="hll">          <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span class="hll">          <span class="nt">&quot;trace&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;malloc&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="hll">            <span class="p">},</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;../memory_collect_test.c&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">22</span>
</span><span class="hll">            <span class="p">},</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;__libc_start_main&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="hll">            <span class="p">},</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;_start&quot;</span><span class="p">,</span>
</span><span class="hll">              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">          <span class="p">],</span>
</span><span class="hll">          <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;../memory_collect_test.c&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">22</span>
</span><span class="hll">          <span class="p">}</span>
</span>        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span>
          <span class="nt">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;free&quot;</span><span class="p">,</span>
          <span class="nt">&quot;address&quot;</span><span class="p">:</span> <span class="mi">19284560</span><span class="p">,</span>
          <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nt">&quot;trace&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;free&quot;</span><span class="p">,</span>
              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;../memory_collect_test.c&quot;</span><span class="p">,</span>
              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">27</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;__libc_start_main&quot;</span><span class="p">,</span>
              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;unreachable&quot;</span><span class="p">,</span>
              <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;_start&quot;</span><span class="p">,</span>
              <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;../memory_collect_test.c&quot;</span><span class="p">,</span>
            <span class="nt">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
            <span class="nt">&quot;line&quot;</span><span class="p">:</span> <span class="mi">27</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.025000&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above is an example of profiled data on a simple binary, which makes several minor allocations.
Profile shows a simple allocation followed by deallocation and highlights important keys and
regions in the <cite>memory</cite> profiles, e.g. the <a class="reference internal" href="profile.html#perfreg-origin"><code class="xref std std-preg docutils literal"><span class="pre">origin</span></code></a>, <code class="xref std std-preg docutils literal"><span class="pre">collector-info</span></code> or
<a class="reference internal" href="profile.html#perfkey-resources"><em class="xref std std-pkey">resources</em></a></p>
<img alt="_images/memory-flow.png" src="_images/memory-flow.png" />
<p>The <a class="reference internal" href="views.html#views-flow"><span class="std std-ref">Flow Plot</span></a> above shows the mean of allocated amounts per each allocation site (i.e.
<code class="docutils literal"><span class="pre">uid</span></code>) in stacked mode. The stacking of the means clearly shows, where the biggest allocations
where made during the program run.</p>
<img alt="_images/memory-flamegraph.png" src="_images/memory-flamegraph.png" />
<p>The <a class="reference internal" href="views.html#views-flame-graph"><span class="std std-ref">Flame Graph</span></a> is an efficient visualization of inclusive consumption of resources.
The width of the base of one flame shows the bottleneck and hotspots of profiled binaries.</p>
<img alt="_images/memory-heapmap.png" src="_images/memory-heapmap.png" />
<p>The <a class="reference internal" href="views.html#views-heapmap"><span class="std std-ref">Heap Map</span></a> shows the address space through the time (snapshots) and visualize the
fragmentation of memory allocation per each allocation site. The <cite>heap map</cite> aboe shows the
difference between allocations using lists (purple), skiplists (pinkish) and standard vectors
(blue). The map itself is interactive and displays details about individual address cells.</p>
<img alt="_images/memory-heatmap.png" src="_images/memory-heatmap.png" />
<p><cite>Heat map</cite> is a mode of heap map, which aggregates the allocations over all of the snapshots and
uses warmer colours for address cells, where more allocations were performed.</p>
</div>
</div>
<div class="section" id="module-perun.collect.time">
<span id="time-collector"></span><span id="collectors-time"></span><h3>Time Collector<a class="headerlink" href="#module-perun.collect.time" title="Permalink to this headline">¶</a></h3>
<p>Time collector collects is a simple wrapper over the time utility. There is
nothing special about this, the profiles are simple, and no visualization is
especially suitable for this mode.</p>
<div class="section" id="id4">
<h4>Overview and Command Line Interface<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="section" id="perun-collect-time">
<h5>perun collect time<a class="headerlink" href="#perun-collect-time" title="Permalink to this headline">¶</a></h5>
<p>Generates <cite>time</cite> performance profile, capturing overall running times of
the profiled command.</p>
<dl class="docutils">
<dt></dt>
<dd><ul class="first last simple">
<li><strong>Limitations</strong>: <cite>none</cite></li>
<li><strong>Metric</strong>: running <cite>time</cite></li>
<li><strong>Dependencies</strong>: <cite>none</cite></li>
<li><strong>Default units</strong>: <cite>s</cite></li>
</ul>
</dd>
</dl>
<p>This is a wrapper over the <code class="docutils literal"><span class="pre">time</span></code> linux unitility and captures resources
in the following form:</p>
<pre class="literal-block">
{
    &quot;amount&quot;: 0.59,
    &quot;type&quot;: &quot;time&quot;,
    &quot;uid&quot;: &quot;sys&quot;
}
</pre>
<p>Refer to <a class="reference internal" href="#collectors-time"><span class="std std-ref">Time Collector</span></a> for more thorough description and examples
of <cite>complexity</cite> collector.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>perun collect <span class="nb">time</span> <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="collectors-time-examples">
<span id="id5"></span><h4>Examples<a class="headerlink" href="#collectors-time-examples" title="Permalink to this headline">¶</a></h4>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="hll">  <span class="nt">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;9524dd21a51ed5d462b802fd3bc7e070462cceac&quot;</span><span class="p">,</span>
</span>  <span class="nt">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;perun&quot;</span><span class="p">,</span>
    <span class="nt">&quot;workload&quot;</span><span class="p">:</span> <span class="s2">&quot;--short&quot;</span><span class="p">,</span>
    <span class="nt">&quot;units&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span>
</span>    <span class="p">}</span>
  <span class="p">},</span>
<span class="hll">  <span class="nt">&quot;collector_info&quot;</span><span class="p">:</span> <span class="p">{</span>
</span>    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;postprocessors&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;global&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2.32&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="hll">      <span class="p">{</span>
</span><span class="hll">        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">0.59</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;sys&quot;</span>
</span><span class="hll">      <span class="p">},</span>
</span>      <span class="p">{</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">0.32</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">2.32</span><span class="p">,</span>
        <span class="nt">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;real&quot;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above is an example of profiled data using the <cite>time</cite> wrapper with important regions and keys
highlighted.</p>
</div>
</div>
</div>
<div class="section" id="creating-your-own-collector">
<span id="collectors-custom"></span><h2>Creating your own Collector<a class="headerlink" href="#creating-your-own-collector" title="Permalink to this headline">¶</a></h2>
<p>New collectors can be registered within Perun in several steps. Internally they can be implemented
in any programming language and in order to work with Perun requires three phases to be specified
as given in <a class="reference internal" href="#collectors-overview"><span class="std std-ref">Collectors Overview</span></a>—<code class="docutils literal"><span class="pre">before()</span></code>, <code class="docutils literal"><span class="pre">collect()</span></code> and <code class="docutils literal"><span class="pre">after()</span></code>. Each new
collector requires a interface module <code class="docutils literal"><span class="pre">run.py</span></code>, which contains the three functions and, moreover,
a cli API for <a class="reference external" href="http://click.pocoo.org/5/">Click</a>.</p>
<p>You can register your new collector as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Run <code class="docutils literal"><span class="pre">perun</span> <span class="pre">utils</span> <span class="pre">create</span> <span class="pre">collect</span> <span class="pre">mycollector</span></code> to generate a new modules in
<code class="docutils literal"><span class="pre">perun/collect</span></code> directory with the following structure. The command takes a predefined
templates for new collectors and creates <code class="docutils literal"><span class="pre">__init__.py</span></code> and <code class="docutils literal"><span class="pre">run.py</span></code> according to the
supplied command line arguments (see <a class="reference internal" href="cli.html#cli-utils-ref"><span class="std std-ref">Utility Commands</span></a> for more information about
interface of <code class="docutils literal"><span class="pre">perun</span> <span class="pre">utils</span> <span class="pre">create</span></code> command):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">perun</span>
<span class="o">|--</span> <span class="o">/</span><span class="n">collect</span>
    <span class="o">|--</span> <span class="o">/</span><span class="n">mycollector</span>
        <span class="o">|--</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="o">|--</span> <span class="n">run</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|--</span> <span class="o">/</span><span class="n">complexity</span>
    <span class="o">|--</span> <span class="o">/</span><span class="n">memory</span>
    <span class="o">|--</span> <span class="o">/</span><span class="n">time</span>
    <span class="o">|--</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">First, implement the <code class="docutils literal"><span class="pre">__init__.py</span></code> file, including the module docstring with brief
collector descriptions and definitions of constants that are used for automatic setting of
profiles (namely the <code class="xref std std-preg docutils literal"><span class="pre">collector-info</span></code>) which has the following structure:</p>
</li>
</ol>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;...&quot;&quot;&quot;</span>

<span class="n">COLLECTOR_TYPE</span> <span class="o">=</span> <span class="s1">&#39;time|memory|mixed&#39;</span>
<span class="n">COLLECTOR_DEFAULT_UNITS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unit&#39;</span>
<span class="p">}</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;You!&#39;</span>
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="3">
<li>Next, implement the <code class="docutils literal"><span class="pre">run.py</span></code> module with <code class="docutils literal"><span class="pre">collect()</span></code> function, (optionally with
<code class="docutils literal"><span class="pre">before()</span></code> and <code class="docutils literal"><span class="pre">after()</span></code>). The <code class="docutils literal"><span class="pre">collect()</span></code> function should do the actual collection of
the profiling data over the given configuration. Each function should return the integer
status of the phase, the status message (used in case of error) and dictionary including
params passed to additional phases and ‘profile’ with dictionary w.r.t <a class="reference internal" href="profile.html#profile-spec"><span class="std std-ref">Specification of Profile Format</span></a>.</li>
</ol>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;(optional)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">STATUS</span><span class="p">,</span> <span class="n">STATUS_MSG</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;...&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">STATUS</span><span class="p">,</span> <span class="n">STATUS_MSG</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;(optional)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">STATUS</span><span class="p">,</span> <span class="n">STATUS_MSG</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="4">
<li>Additionally implement the command line interface function in <code class="docutils literal"><span class="pre">run.py</span></code>, named the same as
your collector. This function will is called from command line as <code class="docutils literal"><span class="pre">perun</span> <span class="pre">collect</span>
<span class="pre">mycollector</span></code> and is based on <a class="reference external" href="http://click.pocoo.org/5/">Click</a> library.</li>
</ol>
<div class="highlight-udiff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gd">--- /mnt/f/phdwork/perun/gh-pages/docs/_static/templates/collectors_run.py</span>
<span class="gi">+++ /mnt/f/phdwork/perun/gh-pages/docs/_static/templates/collectors_run_api.py</span>
<span class="gu">@@ -1,3 +1,8 @@</span>
<span class="gi">+import click</span>
<span class="gi">+</span>
<span class="gi">+import perun.logic.runner as runner</span>
<span class="gi">+</span>
<span class="gi">+</span>
 def before(**kwargs):
     &quot;&quot;&quot;(optional)&quot;&quot;&quot;
     return STATUS, STATUS_MSG, dict(kwargs)
<span class="gu">@@ -11,3 +16,10 @@</span>
 def after(**kwargs):
     &quot;&quot;&quot;(optional)&quot;&quot;&quot;
     return STATUS, STATUS_MSG, dict(kwargs)
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+@click.command()</span>
<span class="gi">+@click.pass_context</span>
<span class="gi">+def mycollector(ctx, **kwargs):</span>
<span class="gi">+    &quot;&quot;&quot;...&quot;&quot;&quot;</span>
<span class="gi">+    runner.run_collector_from_cli_context(ctx, &#39;mycollector&#39;, kwargs)</span>
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="5">
<li>Finally register your newly created module in <code class="xref py py-func docutils literal"><span class="pre">get_supported_module_names()</span></code> located in
<code class="docutils literal"><span class="pre">perun.utils.__init__.py</span></code>:</li>
</ol>
<div class="highlight-udiff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gd">--- /mnt/f/phdwork/perun/gh-pages/docs/_static/templates/supported_module_names.py</span>
<span class="gi">+++ /mnt/f/phdwork/perun/gh-pages/docs/_static/templates/supported_module_names_collectors.py</span>
<span class="gu">@@ -6,7 +6,7 @@</span>
         ))
     return {
         &#39;vcs&#39;: [&#39;git&#39;],
<span class="gd">-        &#39;collect&#39;: [&#39;complexity&#39;, &#39;memory&#39;, &#39;time&#39;],</span>
<span class="gi">+        &#39;collect&#39;: [&#39;complexity&#39;, &#39;memory&#39;, &#39;time&#39;, &#39;mycollector&#39;],</span>
         &#39;postprocess&#39;: [&#39;filter&#39;, &#39;normalizer&#39;, &#39;regression_analysis&#39;],
         &#39;view&#39;: [&#39;alloclist&#39;, &#39;bars&#39;, &#39;flamegraph&#39;, &#39;flow&#39;, &#39;heapmap&#39;, &#39;raw&#39;, &#39;scatter&#39;]
     }[package]
</pre></div>
</td></tr></table></div>
<ol class="arabic" start="6">
<li><p class="first">Preferably, verify that registering did not break anything in the Perun and if you are not
using the developer installation, then reinstall Perun:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">test</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">At this point you can start using your collector either using <code class="docutils literal"><span class="pre">perun</span> <span class="pre">collect</span></code> or using the
following to set the job matrix and run the batch collection of profiles:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">perun</span> <span class="n">config</span> <span class="o">--</span><span class="n">edit</span>
<span class="n">perun</span> <span class="n">run</span> <span class="n">matrix</span>
</pre></div>
</div>
</li>
<li><p class="first">If you think your collector could help others, please, consider making <a class="reference external" href="https://github.com/tfiedor/perun/pull/new/develop">Pull Request</a>.</p>
</li>
</ol>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="index.html">
    <h3>Perun</h3>
  </a>
</p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Collectors Overview</a><ul>
<li><a class="reference internal" href="#supported-collectors">Supported Collectors</a><ul>
<li><a class="reference internal" href="#module-perun.collect.complexity">Complexity Collector</a><ul>
<li><a class="reference internal" href="#overview-and-command-line-interface">Overview and Command Line Interface</a><ul>
<li><a class="reference internal" href="#perun-collect-complexity">perun collect complexity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-perun.collect.memory">Memory Collector</a><ul>
<li><a class="reference internal" href="#id2">Overview and Command Line Interface</a><ul>
<li><a class="reference internal" href="#perun-collect-memory">perun collect memory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collectors-memory-examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-perun.collect.time">Time Collector</a><ul>
<li><a class="reference internal" href="#id4">Overview and Command Line Interface</a><ul>
<li><a class="reference internal" href="#perun-collect-time">perun collect time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collectors-time-examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-your-own-collector">Creating your own Collector</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cli.html" title="previous chapter">Command Line Interface</a></li>
      <li>Next: <a href="postprocessors.html" title="next chapter">Postprocessors Overview</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/collectors.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Tomas Fiedor, Jiri Pavela, et al..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/collectors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>